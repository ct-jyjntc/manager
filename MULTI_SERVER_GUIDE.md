# 多服务器进程管理功能指南

## 🌟 功能概述

进程保活管理器现已支持多服务器管理功能，允许您在一个统一的界面中管理多台服务器上的进程。

## 🚀 新增功能

### 1. 服务器管理
- **添加远程服务器**: 支持通过SSH连接管理远程Linux服务器
- **服务器状态监控**: 实时显示服务器在线/离线状态
- **连接测试**: 测试SSH连接是否正常
- **服务器信息管理**: 编辑服务器配置、描述等信息

### 2. 多服务器进程管理
- **跨服务器进程创建**: 在指定服务器上创建和管理进程
- **统一进程视图**: 在一个界面中查看所有服务器的进程
- **服务器标识**: 每个进程显示所属服务器信息
- **远程进程控制**: 启动、停止、重启远程服务器上的进程

### 3. 用户界面增强
- **服务器选择器**: 创建进程时选择目标服务器
- **服务器管理界面**: 专门的服务器管理模态框
- **状态指示器**: 直观的服务器状态显示
- **响应式设计**: 适配移动端和桌面端

## 📋 使用指南

### 添加新服务器

1. 点击主界面右上角的"服务器"按钮
2. 在服务器管理界面点击"添加服务器"
3. 填写服务器信息：
   - **服务器名称**: 便于识别的名称
   - **主机地址**: IP地址或域名
   - **端口**: SSH端口（默认22）
   - **用户名**: SSH登录用户名
   - **密码**: SSH登录密码
   - **描述**: 可选的服务器描述

4. 点击"添加"保存服务器配置
5. 系统会自动测试连接并显示状态

### 管理服务器

- **测试连接**: 点击"测试连接"按钮验证SSH连接
- **编辑服务器**: 点击"编辑"按钮修改服务器配置
- **删除服务器**: 点击"删除"按钮移除服务器（本地服务器不可删除）
- **查看状态**: 服务器卡片显示实时连接状态

### 创建多服务器进程

1. 在主界面的"添加新进程"区域
2. 首先选择"目标服务器"
3. 填写进程信息：
   - **进程名称**: 进程的显示名称
   - **执行命令**: 要运行的命令
   - **工作目录**: 进程的工作目录

4. 点击"创建进程"
5. 进程将在指定服务器上创建

### 管理多服务器进程

- **查看进程**: 所有服务器的进程显示在统一列表中
- **服务器标识**: 每个进程卡片显示所属服务器名称
- **进程控制**: 启动、停止、重启功能支持远程服务器
- **日志查看**: 查看本地和远程进程的运行日志

## 🔧 技术架构

### 后端组件

1. **ServerManager**: 服务器管理核心类
   - 服务器配置存储和管理
   - SSH连接管理和心跳检测
   - 服务器状态监控

2. **MultiServerProcessManager**: 多服务器进程管理器
   - 统一的进程管理接口
   - 本地和远程进程的协调管理
   - SSH命令执行和进程控制

3. **API路由扩展**:
   - `/api/servers` - 服务器管理API
   - `/api/servers/[id]` - 单个服务器操作
   - `/api/servers/[id]/test` - 连接测试
   - 扩展的进程API支持serverId参数

### 前端组件

1. **ServerManager组件**: 服务器管理界面
2. **服务器选择器**: 进程创建时的服务器选择
3. **增强的进程卡片**: 显示服务器信息
4. **状态指示器**: 服务器连接状态显示

## 🔒 安全考虑

### SSH连接安全
- 支持密码和密钥认证
- 连接超时和错误处理
- 敏感信息不存储在前端

### 数据安全
- 服务器密码加密存储
- SSH连接状态监控
- 连接失败自动重试机制

### 访问控制
- 本地服务器特殊保护（不可删除）
- 服务器操作权限控制
- 进程操作审计日志

## 📊 监控和状态

### 服务器状态
- **在线**: SSH连接正常
- **离线**: 无法建立SSH连接
- **连接中**: 正在尝试连接
- **错误**: 连接出现错误

### 心跳检测
- 每30秒自动检查服务器状态
- 连接失败自动重试
- 状态变化实时更新

### 性能监控
- 连接延迟测量
- 服务器响应时间
- 进程执行状态跟踪

## 🚧 当前限制

### 远程功能限制
- 远程进程日志收集需要进一步开发
- 远程服务器统计信息获取待完善
- SSH密钥认证支持需要增强

### 扩展计划
- 支持更多认证方式（SSH密钥、证书）
- 远程文件管理功能
- 批量服务器操作
- 服务器分组和标签管理
- 更详细的服务器监控指标

## 🔧 配置文件

### 服务器配置存储
- 文件位置: `servers.json`
- 自动备份和恢复
- 配置导入导出功能

### 远程进程数据
- 文件位置: `multi-server-processes.json`
- 进程状态持久化
- 跨重启数据保持

## 🎯 最佳实践

### 服务器管理
1. 使用描述性的服务器名称
2. 定期测试服务器连接
3. 监控服务器状态变化
4. 及时更新服务器配置

### 进程管理
1. 明确指定目标服务器
2. 使用绝对路径的命令
3. 设置合适的工作目录
4. 定期检查进程状态

### 安全建议
1. 使用强密码或SSH密钥
2. 限制SSH用户权限
3. 定期更新服务器密码
4. 监控异常连接活动

## 🐛 故障排除

### 常见问题

1. **SSH连接失败**
   - 检查网络连接
   - 验证服务器地址和端口
   - 确认用户名和密码
   - 检查SSH服务状态

2. **进程创建失败**
   - 确认目标服务器在线
   - 检查命令路径和权限
   - 验证工作目录存在
   - 查看错误日志信息

3. **状态更新延迟**
   - 网络延迟影响
   - 服务器负载过高
   - SSH连接不稳定
   - 心跳检测间隔设置

### 调试方法
- 查看浏览器控制台日志
- 检查服务器端日志输出
- 使用连接测试功能
- 监控网络连接状态

## 📈 未来发展

### 计划功能
- 服务器集群管理
- 负载均衡和故障转移
- 更丰富的监控指标
- 图形化性能展示
- 自动化部署工具

### 技术改进
- WebSocket实时通信
- 更高效的SSH连接池
- 缓存和性能优化
- 更好的错误处理机制

---

通过这些多服务器功能，您现在可以在一个统一的界面中管理多台服务器上的进程，大大提高了运维效率和管理便利性。
